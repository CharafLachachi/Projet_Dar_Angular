{"version":3,"file":"overlay-trigger.js","sourceRoot":"","sources":["../../../../../../.ng_build/theme/components/cdk/overlay/overlay-trigger.ts"],"names":[],"mappings":"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","sourcesContent":["import { ComponentRef } from '@angular/core';\nimport { fromEvent as observableFromEvent, merge as observableMerge, Observable } from 'rxjs';\nimport { debounceTime, delay, filter, repeat, share, switchMap, takeUntil, takeWhile, map } from 'rxjs/operators';\n\n\nexport enum NbTrigger {\n  CLICK = 'click',\n  HOVER = 'hover',\n  HINT = 'hint',\n  FOCUS = 'focus',\n}\n\n/**\n * Provides entity with two event stream: show and hide.\n * Each stream provides different events depends on implementation.\n * We have three main trigger strategies: click, hint and hover.\n * */\n/**\n * TODO maybe we have to use renderer.listen instead of observableFromEvent?\n * Renderer provides capability use it in service worker, ssr and so on.\n * */\nexport abstract class NbTriggerStrategy {\n\n  protected isNotOnHostOrContainer(event: Event): boolean {\n    return !this.isOnHost(event) && !this.isOnContainer(event);\n  }\n\n  protected isOnHostOrContainer(event: Event): boolean {\n    return this.isOnHost(event) || this.isOnContainer(event);\n  }\n\n  protected isOnHost({ target }: Event): boolean {\n    return this.host.contains(target as Node);\n  }\n\n  protected isOnContainer({ target }: Event): boolean {\n    return this.container() && this.container().location.nativeElement.contains(target);\n  }\n\n  abstract show$: Observable<Event>;\n  abstract hide$: Observable<Event>;\n\n  constructor(protected document: Document, protected host: HTMLElement, protected container: () => ComponentRef<any>) {\n  }\n}\n\n/**\n * Creates show and hide event streams.\n * Fires toggle event when the click was performed on the host element.\n * Fires close event when the click was performed on the document but\n * not on the host or container.\n * */\nexport class NbClickTriggerStrategy extends NbTriggerStrategy {\n\n  // since we should track click for both SHOW and HIDE event we firstly need to track the click and the state\n  // of the container and then later on decide should we hide it or show\n  // if we track the click & state separately this will case a behavior when the container is getting shown\n  // and then hidden right away\n  protected click$: Observable<[boolean, Event]> = observableFromEvent<Event>(this.document, 'click')\n    .pipe(\n      map((event: Event) => [!this.container() && this.isOnHost(event), event] as [boolean, Event]),\n      share(),\n    );\n\n  readonly show$: Observable<Event> = this.click$\n    .pipe(\n      filter(([shouldShow]) => shouldShow),\n      map(([, event]) => event),\n    );\n\n  readonly hide$: Observable<Event> = this.click$\n    .pipe(\n      filter(([shouldShow, event]) => !shouldShow && !this.isOnContainer(event)),\n      map(([, event]) => event),\n    );\n}\n\n/**\n * Creates show and hide event streams.\n * Fires open event when a mouse hovers over the host element and stay over at least 100 milliseconds.\n * Fires close event when the mouse leaves the host element and stops out of the host and popover container.\n * */\nexport class NbHoverTriggerStrategy extends NbTriggerStrategy {\n\n  show$: Observable<Event> = observableFromEvent<Event>(this.host, 'mouseenter')\n    .pipe(\n      delay(100),\n      takeUntil(observableFromEvent(this.host, 'mouseleave')),\n      repeat(),\n    );\n\n  hide$: Observable<Event> = observableFromEvent<Event>(this.host, 'mouseleave')\n    .pipe(\n      switchMap(() => observableFromEvent<Event>(this.document, 'mousemove')\n        .pipe(\n          debounceTime(100),\n          takeWhile(() => !!this.container()),\n          filter(event => this.isNotOnHostOrContainer(event),\n          ),\n        ),\n      ),\n    );\n}\n\n/**\n * Creates show and hide event streams.\n * Fires open event when a mouse hovers over the host element and stay over at least 100 milliseconds.\n * Fires close event when the mouse leaves the host element.\n * */\nexport class NbHintTriggerStrategy extends NbTriggerStrategy {\n  show$: Observable<Event> = observableFromEvent<Event>(this.host, 'mouseenter')\n    .pipe(\n      delay(100),\n      takeUntil(observableFromEvent(this.host, 'mouseleave')),\n      // this `delay & takeUntil & repeat` operators combination is a synonym for `conditional debounce`\n      // meaning that if one event occurs in some time after the initial one we won't react to it\n      repeat(),\n    );\n\n  hide$: Observable<Event> = observableFromEvent(this.host, 'mouseleave');\n}\n\n\n/**\n * Creates show and hide event streams.\n * Fires open event when a focus is on the host element and stay over at least 100 milliseconds.\n * Fires close event when the focus leaves the host element.\n * */\nexport class NbFocusTriggerStrategy extends NbTriggerStrategy {\n\n  protected focusOut$: Observable<Event> = observableFromEvent<Event>(this.host, 'focusout')\n    .pipe(\n      switchMap(() => observableFromEvent<Event>(this.document, 'focusin')\n        .pipe(\n          takeWhile(() => !!this.container()),\n          filter(event => this.isNotOnHostOrContainer(event)),\n        ),\n      ),\n    );\n\n  protected clickIn$: Observable<Event> = observableFromEvent<Event>(this.host, 'click')\n    .pipe(\n      filter(() => !this.container()),\n    );\n\n  protected clickOut$: Observable<Event> = observableFromEvent<Event>(this.document, 'click')\n    .pipe(\n      filter(() => !!this.container()),\n      filter(event => this.isNotOnHostOrContainer(event)),\n    );\n\n  protected tabKeyPress$: Observable<Event> = observableFromEvent<Event>(this.document, 'keydown')\n    .pipe(\n      filter((event: KeyboardEvent) => event.keyCode === 9),\n      filter(() => !!this.container()),\n    );\n\n  show$: Observable<Event> = observableMerge(observableFromEvent<Event>(this.host, 'focusin'), this.clickIn$)\n    .pipe(\n      filter(() => !this.container()),\n      debounceTime(100),\n      takeUntil(observableFromEvent(this.host, 'focusout')),\n      repeat(),\n    );\n\n  hide$ = observableMerge(this.focusOut$, this.tabKeyPress$, this.clickOut$);\n}\n\nexport class NbTriggerStrategyBuilder {\n  protected _host: HTMLElement;\n  protected _container: () => ComponentRef<any>;\n  protected _trigger: NbTrigger;\n  protected _document: Document;\n\n  document(document: Document): this {\n    this._document = document;\n    return this;\n  }\n\n  trigger(trigger: NbTrigger): this {\n    this._trigger = trigger;\n    return this;\n  }\n\n  host(host: HTMLElement): this {\n    this._host = host;\n    return this;\n  }\n\n  container(container: () => ComponentRef<any>): this {\n    this._container = container;\n    return this;\n  }\n\n  build(): NbTriggerStrategy {\n    switch (this._trigger) {\n      case NbTrigger.CLICK:\n        return new NbClickTriggerStrategy(this._document, this._host, this._container);\n      case NbTrigger.HINT:\n        return new NbHintTriggerStrategy(this._document, this._host, this._container);\n      case NbTrigger.HOVER:\n        return new NbHoverTriggerStrategy(this._document, this._host, this._container);\n      case NbTrigger.FOCUS:\n        return new NbFocusTriggerStrategy(this._document, this._host, this._container);\n      default:\n        throw new Error('Trigger have to be provided');\n    }\n  }\n}\n"]}